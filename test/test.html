<!DOCTYPE html>
<html>
  <head>

    <title>AJST : Asynchronous JavaScript Templating</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">

    <script src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.8/require.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <style type="text/css">
      @media (min-width: 980px) {
        body {
          padding-top: 60px;
        }
      }
    </style>

    <!--[if lt IE 9]>
    <style>
    body {
      padding-top: 60px;
    }
    </style>
    <![endif]-->

    <script>

      require(['../js/AJST'], function() {
        $(function() {
          AJST.option({debug: true});
          startTest();
        });
      });

      function startTest() {

        var TestGroups = {
          'Result Samples': [
            {
              id: 'if test success',
              func: function(id) {
                return AJST(id, null, {url: './tpl/UnitTest.tpl'});
              },
              result: "Succeed"
            },
            {
              id: 'if test fail',
              func: function(id) {
                return AJST(id, null, {url: './tpl/UnitTest.tpl'});
              },
              result: "Failed"
            },
            {
              id: 'on error - could not found TPL File.',
              func: function(id) {
                return AJST(id, null, {url: '404.not.found.tpl'});
              },
              result: "Error"
            },
            {
              id: 'on error - undefined TPL ID.',
              func: function(id) {
                return AJST(id, null, {url: './tpl/UnitTest.tpl'});
              },
              result: "Error"
            },
            {
              id: 'on error - Template syntax error.',
              func: function(id) {
                return AJST(id, null, {url: './tpl/UnitTest.tpl'});
              },
              result: "Error"
            },
            {
              id: 'on error - Compile error.',
              func: function(id) {
                return AJST(id, null, {url: './tpl/UnitTest.tpl'});
              },
              result: "Error"
            }
          ],
          'TestCase : Basic': [
            {
              id: 'Hello AJST!',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase1.tpl'});
              },
              result: "Hello!!"
            },
            {
              id: 'Condition: if else',
              func: function(id) {
                return AJST(id, {list: []}, {url: './tpl/TestCase1.tpl'});
              },
              result: "\nis true\n"
            },
            {
              id: 'Condition: switch case',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase1.tpl'});
              },
              result: "True"
            },
            {
              id: 'For',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase1.tpl'});
              },
              result: "\n  i = 1\n\n  i = 2\n\n  i = 3\n"
            },
            {
              id: 'For key:value',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase1.tpl'});
              },
              result: "\n  key = 1\n  value = A\n\n  key = 2\n  value = B\n\n  key = 3\n  value = C\n"
            },
            {
              id: 'ForEach',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase1.tpl'});
              },
              result: "\n  i = 1\n\n  i = 2\n\n  i = 3\n"
            },
            {
              id: 'Sub function',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase1.tpl'});
              },
              result: "\n  1 + 1 = 2\n  2 + 2 = 4\n  3 + 3 = 6"
            }
          ],
          'TestCase : Print & Utils': [
            {
              id: 'Template Output String',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase2.tpl'});
              },
              result: "Outside Tag. Output String.\nInside Tag. use print() or printf().\nClosed Tag. Output String.\nAnd <?=Output?>"
            },
            {
              id: 'print',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase2.tpl'});
              },
              result: "1 + 1 = 2\n2 + 2 = 4\n3 + 3 = 6\n"
            },
            {
              id: 'printf',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase2.tpl'});
              },
              result: "1 + 1 = 2.200\n2 + 2 = 4.400\n3 + 3 = 6.600\n"
            },
            {
              id: 'sprintf',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase2.tpl'});
              },
              result: "1 + 1 = 2.200\n2 + 2 = 4.400\n3 + 3 = 6.600\n"
            },
            {
              id: 'util.tag_escape, util.tag_unescape',
              func: function(id) {
                return AJST(id, {
                  tag: "<h4>It's H4 Tag!</h4>"
                }, {url: './tpl/TestCase2.tpl'});
              },
              result: "original  = <h4>It's H4 Tag!</h4>\nescaped   = &lt;h4&gt;It&#039;s H4 Tag!&lt;/h4&gt;\nunescaped = <h4>It's H4 Tag!</h4>"
            },
            {
              id: 'util-sub function definition',
              func: function(id) {
                return AJST(id, null, {
                  url: './tpl/TestCase2.tpl',
                  util: {
                    add: function(a, b) {
                      return +a + +b;
                    }
                  }
                });
              },
              result: "1 + 1 = 2\n2 + 2 = 4\n3 + 3 = 6\n"
            }
          ],
          'TestCase : Data': [
            {
              id: 'Template data',
              func: function(id) {
                return AJST(id, 'This is Template Data', {url: './tpl/TestCase3.tpl'});
              },
              result: "This is Template Data"
            },
            {
              id: 'Array data',
              func: function(id) {
                return AJST(id, [1, 2, 3], {url: './tpl/TestCase3.tpl'});
              },
              result: "1, 2, 3"
            },
            {
              id: 'Object data',
              func: function(id) {
                return AJST(id, {
                  list: [1, 2, 3],
                  add: function(a, b) {
                    return +a + +b;
                  }
                }, {url: './tpl/TestCase3.tpl'});
              },
              result: "1 + 1 = 2\n2 + 2 = 4\n3 + 3 = 6\n"
            }
          ],
          'TestCase : Include': [
            {
              id: 'Include TPL',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase4.tpl'});
              },
              result: "This is Include TPL.sub"
            },
            {
              id: 'Include other tpl file',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase4.tpl'});
              },
              result: "This is include1."
            },
            {
              id: 'Include more..',
              func: function(id) {
                return AJST(id, null, {url: './tpl/TestCase4.tpl'});
              },
              result: "This is include2.\nInclude other tpl.\nThis is include1."
            },
            {
              id: 'Include multiple promise',
              func: function(id) {
                return new AJST.Promise([
                  AJST('include1'),
                  AJST('include2'),
                  AJST(id, null, {url: './tpl/TestCase4.tpl'})
                ]).then(function() {
                  return Array.prototype.join.call(arguments, '');
                });
              },
              result: "This is include1.This is include2.\nInclude other tpl.\nThis is include1.Succeed!"
            }
          ],
          'Examples': [
            {
              id: 'MemberList',
              func: function(id) {
                return AJST(id, [
                  {nickname: 'John', age: 10},
                  {nickname: 'Sam', age: 13},
                  {nickname: 'Smith', age: 7},
                  {nickname: 'Dextor', age: 12},
                  {nickname: 'Christin', age: 9}
                ]);
              },
              result: "AJST MemberList Sample..\n<table class=\"table\">\n  <caption>Member List Table</caption>\n  <thead><th>nickname</th><th>age</th></thead>\n  <tbody>\n<tr><td>John</td><td>10</td></tr>\n<tr><td>Sam</td><td>13</td></tr>\n<tr><td>Smith</td><td>7</td></tr>\n<tr><td>Dextor</td><td>12</td></tr>\n<tr><td>Christin</td><td>9</td></tr>\n\n</tbody>\n</table>"
            }
          ]

        };

        var $list = $('#TestList'),
            $result = $('#Result');

        for (var caseName in TestGroups) {

          $('<li/>')
              .html('<a href="#">' + caseName + '</a>')
              .attr({href: '#'})
              .appendTo($list)
              .children('A')
              .click(caseName, function(event) {

            newTest(TestGroups[event.data], event.data);

            return false;

          });

        }

        newTest(TestGroups['Result Samples'], 'Result Samples');

        function tag_escape(s) {
          return s.toString().replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/'/g, '&#039;').replace(/"/g, '&quot;');
        }

        function tag_unescape(s) {
          return s.toString().replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&#0*39;/g, "'").replace(/&quot;/g, '"').replace(/&amp;/g, '&');
        }

        function newTest(TestList, caseName) {

          console.clear();

          $result.empty().append('<h3>' + caseName + '</h3>');

          TestList.forEach(function(test, idx) {

            var id = 'TestList_' + idx;

            var $group = $('<div/>').addClass('accordion-group').appendTo($result),
                $head = $('<div/>').addClass('accordion-heading').appendTo($group),
                $label = $('<span/>').addClass('label').html('<i class="icon-play-circle"></i> Loading..').appendTo($head),
                $toggle = $('<a/>').addClass('accordion-toggle inline').attr({href: '#' + id, 'data-toggle': 'collapse', 'data-parent': '#Result'}).text('Test ' + (idx + 1) + ' - ' + test.id).appendTo($head),
                $body = $('<div/>').addClass('accordion-body collapse').attr('id', id).appendTo($group),
                $inner = $('<div/>').addClass('accordion-inner').appendTo($body);

            $inner
                .append('<h4>Test Code</h4>')
                .append('<pre>(' + tag_escape(test.func).replace(/              /g, '') + ')("' + test.id + '").then(function(output){ alert(output); });</pre>');

            test.func(test.id).then(function(result) {

              $inner
                  .append('<h4>Template Source</h4>')
                  .append('<pre>' + tag_escape(AJST.getTemplate(test.id)) + '</pre>');

              if (result == test.result) {
                $label.addClass('label-success').html('<i class="icon-ok"></i> Success');
                $inner
                    .append('<h4>Result HTML Code</h4>')
                    .append('<pre>' + tag_escape(result) + '</pre>')
                    .append('<h4>Result Object</h4>')
                    .append(result);
              }

              else {

                $label.addClass('label-warning').html('<i class="icon-remove"></i> Fail');
                $inner
                    .append('<h4>Result HTML Code</h4>')
                    .append('<pre>' + tag_escape(result) + '</pre>')
                    .append('<h4>Right Result</h4>')
                    .append('<pre>' + tag_escape(test.result) + '</pre>')
                    .append('<h4>Result JSON</h4>')
                    .append('<code>' + tag_escape(JSON.stringify(result)) + '</code>');

                console.log(test.id + '\n', JSON.stringify(result));

              }

            }).fail(function(e) {

              try {
                var tpl = tag_escape(AJST.getTemplate(test.id) || ''),
                    compiler = tpl ? tag_escape(AJST.getCompiler(test.id) || '') : '';
              } catch (e) {
              }

              $label.removeClass('label-warning').addClass('label-important').html('<i class="icon-remove"></i> Error : ' + e.message);
              $inner
                  .append('<h4>Error</h4>')
                  .append('<p>' + e.message + '</p>')
                  .append('<h4>Template Source</h4>')
                  .append('<pre>' + tpl + '</pre>')
                  .append('<h4>Compiler</h4>')
                  .append('<pre>' + compiler + '</pre>');

            });
          });
        }
      }

    </script>

  </head>
  <body>

    <!-- navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="test.html">AJST</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="test.html">Unit Test</a></li>
              <li><a href="https://github.com/bitofsky/Async-JSTemplate">Github</a></li>
              <li><a href="https://github.com/bitofsky/Async-JSTemplate/archive/master.zip">Download</a></li>
              <li><a href="https://github.com/bitofsky/Async-JSTemplate/blob/master/js/async_jstemplate.js">Source</a></li>
            </ul>
            <ul class="nav pull-right">
              <li><a href="https://github.com/bitofsky/Async-JSTemplate/issues">@Issues</a></li>
              <li><a href="mailto:bitofsky0@yahoo.co.kr?subject=[Async-JSTemplate]">@Contact</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- navbar -->

    <!-- container -->
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2">
          <div class="well sidebar-nav">
            <ul class="nav nav-list" id="TestList">
              <li class="nav-header">Test List</li>

            </ul>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span10" >
          <div class="accordion" id="Result">
          </div>
        </div><!--/span-->
      </div><!--/row-->

    </div><!--/.fluid-container-->
    <!-- container -->

  </body>
</html>
